<!DOCTYPE html>
<html lang="ja" data-theme="Crystal">
<head>
  <meta charset="UTF-8" />
  <title>MoodOS v3.5 - MoodCalendar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 後で Part2 で CSS を追加 -->
  <style>
    /* =========================================================
   Part2-A : Base Layout / Common UI
   MoodOS v3.5
   ※ テーマ別の色・演出は Part2-B 以降で追加
========================================================= */

/* ------------------------------
   Reset
------------------------------ */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  font-family: "Segoe UI", "Hiragino Sans", "Noto Sans JP", sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.4s, color 0.4s;
}

/* ------------------------------
   CSS Variables (Base)
   ※ テーマごとの上書きは Part2-B で追加
------------------------------ */
:root {
  --bg: #f5f5f5;
  --text: #222;
  --panel-bg: rgba(255,255,255,0.6);
  --panel-border: rgba(0,0,0,0.1);
  --accent: #4aa8ff;
  --shadow: rgba(0,0,0,0.1);
}

/* ------------------------------
   Layout
------------------------------ */
#app-root {
  display: flex;
  flex-direction: column;
  height: 100vh;
}

/* ------------------------------
   Header
------------------------------ */
.app-header {
  padding: 16px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--panel-bg);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--panel-border);
  box-shadow: 0 2px 6px var(--shadow);
}

.app-title {
  font-size: 28px;
  font-weight: 700;
}

.app-subtitle {
  font-size: 12px;
  opacity: 0.7;
}

.header-buttons {
  display: flex;
  gap: 8px;
}

.header-btn {
  padding: 6px 12px;
  border: 1px solid var(--panel-border);
  background: rgba(255,255,255,0.4);
  backdrop-filter: blur(6px);
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s;
}

.header-btn:hover {
  background: rgba(255,255,255,0.7);
}

/* ------------------------------
   Main Layout
------------------------------ */
.app-main {
  flex: 1;
  display: flex;
  overflow: hidden;
}

/* ------------------------------
   Calendar Section
------------------------------ */
.calendar-section {
  flex: 2;
  padding: 20px;
  overflow-y: auto;
}

.calendar-header-row {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  margin-bottom: 8px;
  font-weight: 600;
  opacity: 0.8;
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
}

.calendar-cell {
  padding: 12px;
  min-height: 70px;
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}

.calendar-cell:hover {
  background: rgba(255,255,255,0.8);
}

.calendar-cell.selected {
  border: 2px solid var(--accent);
}

/* ------------------------------
   Side Panel
------------------------------ */
.side-panel-section {
  flex: 1;
  padding: 20px;
  border-left: 1px solid var(--panel-border);
  background: var(--panel-bg);
  backdrop-filter: blur(10px);
  overflow-y: auto;
}

.panel-title {
  font-size: 20px;
  margin-bottom: 8px;
}

.panel-subtitle {
  font-size: 14px;
  opacity: 0.8;
  margin-bottom: 4px;
}

/* ------------------------------
   Machine-kun (Base)
   ※ テーマ別コスチュームは Part2-B で追加
------------------------------ */
.machine-bubble-wrapper {
  margin: 12px 0;
}

.machine-bubble {
  display: flex;
  gap: 12px;
  align-items: center;
  padding: 12px;
  border-radius: 12px;
  background: rgba(255,255,255,0.5);
  border: 1px solid var(--panel-border);
  backdrop-filter: blur(8px);
  opacity: 1;
  transition: 0.3s;
}

.machine-bubble.hidden {
  opacity: 0;
  pointer-events: none;
}

.machine-face {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  background: #ddd;
  position: relative;
}

.machine-eye {
  position: absolute;
  width: 6px;
  height: 6px;
  background: #333;
  border-radius: 50%;
  top: 12px;
}

.machine-eye.left { left: 10px; }
.machine-eye.right { right: 10px; }

.machine-mouth {
  position: absolute;
  width: 14px;
  height: 3px;
  background: #333;
  border-radius: 2px;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
}

.machine-message {
  font-size: 14px;
  line-height: 1.4;
}

/* ------------------------------
   Buttons
------------------------------ */
.primary-btn {
  padding: 10px 16px;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}

.primary-btn:hover {
  opacity: 0.85;
}

.secondary-btn {
  padding: 8px 14px;
  background: rgba(255,255,255,0.4);
  border: 1px solid var(--panel-border);
  border-radius: 6px;
  cursor: pointer;
}

.danger-btn {
  padding: 8px 14px;
  background: #ff4a4a;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

/* ------------------------------
   Modal (Base)
------------------------------ */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(4px);
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.3s;
}

.modal-backdrop.hidden {
  opacity: 0;
  pointer-events: none;
}

.modal {
  width: 420px;
  max-width: 90%;
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: 12px;
  padding: 20px;
  backdrop-filter: blur(12px);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-title {
  font-size: 20px;
}

.modal-close-btn {
  background: none;
  border: none;
  font-size: 22px;
  cursor: pointer;
}

.modal-body {
  margin-top: 12px;
}

.modal-section {
  margin-top: 16px;
}

.modal-label {
  font-size: 14px;
  opacity: 0.8;
}

.modal-textarea {
  width: 100%;
  margin-top: 6px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid var(--panel-border);
  background: rgba(255,255,255,0.6);
  resize: vertical;
}

/* ------------------------------
   Negative Launch Layer (Base)
   ※ テーマ別演出は Part2-D で追加
------------------------------ */
.negative-launch-layer {
  position: fixed;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  transition: 0.3s;
}

.negative-launch-layer.active {
  opacity: 1;
}

.negative-card {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 260px;
  padding: 16px;
  background: #fff;
  border-radius: 12px;
  transform: translate(-50%, -50%);
  text-align: center;
  font-size: 14px;
  white-space: pre-wrap;
}

/* ------------------------------
   Settings Panel (Base)
------------------------------ */
.settings-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(4px);
  display: flex;
  justify-content: flex-end;
  transition: 0.3s;
}

.settings-backdrop.hidden {
  opacity: 0;
  pointer-events: none;
}

.settings-panel {
  width: 360px;
  height: 100%;
  background: var(--panel-bg);
  border-left: 1px solid var(--panel-border);
  backdrop-filter: blur(12px);
  padding: 20px;
  overflow-y: auto;
}

.settings-section {
  margin-top: 24px;
}

.theme-card-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}

.theme-card {
  display: flex;
  gap: 12px;
  padding: 12px;
  border-radius: 12px;
  background: rgba(255,255,255,0.5);
  border: 1px solid var(--panel-border);
  cursor: pointer;
  transition: 0.2s;
}

.theme-card:hover {
  background: rgba(255,255,255,0.8);
}

.theme-card-preview {
  width: 60px;
  height: 60px;
  border-radius: 10px;
}

/* プレビュー色は Part2-E でテーマ別に追加 */

/* =========================================================
   Part2-B : Machine-kun Costumes (5 Themes)
   MoodOS v3.5
========================================================= */

/* -----------------------------------------
   Crystal（透明・ガラス）
----------------------------------------- */
[data-theme="Crystal"] .machine-face {
  background: rgba(255,255,255,0.4);
  border: 2px solid rgba(255,255,255,0.8);
  box-shadow: 0 0 12px rgba(255,255,255,0.6);
  backdrop-filter: blur(6px);
}

[data-theme="Crystal"] .machine-eye {
  background: rgba(255,255,255,0.9);
}

[data-theme="Crystal"] .machine-mouth {
  background: rgba(255,255,255,0.9);
}

/* 吹き出し */
[data-theme="Crystal"] .machine-bubble {
  background: rgba(255,255,255,0.45);
  border: 1px solid rgba(255,255,255,0.7);
  box-shadow: 0 0 10px rgba(255,255,255,0.4);
}

/* -----------------------------------------
   Midnight（夜・青）
----------------------------------------- */
[data-theme="Midnight"] .machine-face {
  background: linear-gradient(145deg, #0d1b2a, #1b263b);
  border: 2px solid #415a77;
  box-shadow: 0 0 10px rgba(65,90,119,0.6);
}

[data-theme="Midnight"] .machine-eye {
  background: #e0eaff;
}

[data-theme="Midnight"] .machine-mouth {
  background: #e0eaff;
}

[data-theme="Midnight"] .machine-bubble {
  background: rgba(20,30,50,0.6);
  border: 1px solid rgba(100,130,160,0.4);
  box-shadow: 0 0 12px rgba(80,110,150,0.3);
}

/* -----------------------------------------
   Cosmos（宇宙）
----------------------------------------- */
[data-theme="Cosmos"] .machine-face {
  background: radial-gradient(circle at 30% 30%, #ffffff 0%, #8a7cff 20%, #1a1033 70%);
  border: 2px solid #b8aaff;
  box-shadow: 0 0 14px rgba(180,160,255,0.7);
  position: relative;
  overflow: hidden;
}

/* 星屑アニメーション */
[data-theme="Cosmos"] .machine-face::after {
  content: "";
  position: absolute;
  inset: 0;
  background: url('data:image/svg+xml;utf8,\
  <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60">\
  <circle cx="5" cy="5" r="1" fill="white" />\
  <circle cx="20" cy="15" r="1" fill="white" />\
  <circle cx="40" cy="30" r="1" fill="white" />\
  <circle cx="10" cy="45" r="1" fill="white" />\
  </svg>') repeat;
  opacity: 0.4;
  animation: cosmosStars 6s linear infinite;
}

@keyframes cosmosStars {
  from { transform: translateY(0); }
  to { transform: translateY(-20px); }
}

[data-theme="Cosmos"] .machine-eye {
  background: #fff;
  box-shadow: 0 0 6px #fff;
}

[data-theme="Cosmos"] .machine-mouth {
  background: #fff;
}

[data-theme="Cosmos"] .machine-bubble {
  background: rgba(10,10,20,0.6);
  border: 1px solid rgba(200,200,255,0.4);
  box-shadow: 0 0 14px rgba(150,150,255,0.4);
}

/* -----------------------------------------
   Neon（未来・サイバー）
----------------------------------------- */
[data-theme="Neon"] .machine-face {
  background: #0a0a0a;
  border: 2px solid #00eaff;
  box-shadow: 0 0 14px #00eaff;
  position: relative;
  overflow: hidden;
}

/* ネオンライン */
[data-theme="Neon"] .machine-face::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent 0%, #00eaff 50%, transparent 100%);
  opacity: 0.4;
  animation: neonScan 2s linear infinite;
}

@keyframes neonScan {
  from { transform: translateX(-100%); }
  to { transform: translateX(100%); }
}

[data-theme="Neon"] .machine-eye {
  background: #00eaff;
  box-shadow: 0 0 6px #00eaff;
}

[data-theme="Neon"] .machine-mouth {
  background: #00eaff;
  box-shadow: 0 0 4px #00eaff;
}

[data-theme="Neon"] .machine-bubble {
  background: rgba(0,20,30,0.6);
  border: 1px solid #00eaff;
  box-shadow: 0 0 12px rgba(0,234,255,0.4);
}

/* -----------------------------------------
   Ruins（古代文明）
----------------------------------------- */
[data-theme="Ruins"] .machine-face {
  background: linear-gradient(145deg, #c2a878, #8d6e4a);
  border: 2px solid #5e4b32;
  box-shadow: 0 0 10px rgba(120,90,60,0.4);
  position: relative;
  overflow: hidden;
}

/* ひび割れ模様 */
[data-theme="Ruins"] .machine-face::after {
  content: "";
  position: absolute;
  inset: 0;
  background: url('data:image/svg+xml;utf8,\
  <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60">\
  <path d="M10 0 L20 20 L5 40 L25 60" stroke="#5e4b32" stroke-width="2" fill="none"/>\
  <path d="M40 0 L30 20 L45 40 L35 60" stroke="#5e4b32" stroke-width="2" fill="none"/>\
  </svg>') repeat;
  opacity: 0.3;
}

[data-theme="Ruins"] .machine-eye {
  background: #2b1d0f;
}

[data-theme="Ruins"] .machine-mouth {
  background: #2b1d0f;
}

[data-theme="Ruins"] .machine-bubble {
  background: rgba(180,150,110,0.5);
  border: 1px solid rgba(90,70,50,0.6);
  box-shadow: 0 0 10px rgba(90,70,50,0.3);
}
/* =========================================================
   Part2-C : Speech Bubble Themes (5 Themes)
   MoodOS v3.5
========================================================= */

/* -----------------------------------------
   Crystal（透明・ガラス）
----------------------------------------- */
[data-theme="Crystal"] .machine-bubble {
  background: rgba(255,255,255,0.35);
  border: 1px solid rgba(255,255,255,0.7);
  box-shadow: 0 0 12px rgba(255,255,255,0.4);
  backdrop-filter: blur(10px);
}

/* -----------------------------------------
   Midnight（夜・青）
----------------------------------------- */
[data-theme="Midnight"] .machine-bubble {
  background: rgba(15,20,40,0.6);
  border: 1px solid rgba(80,110,150,0.4);
  box-shadow: 0 0 14px rgba(80,110,150,0.3);
  color: #e0eaff;
}

/* -----------------------------------------
   Cosmos（宇宙）
----------------------------------------- */
[data-theme="Cosmos"] .machine-bubble {
  background: rgba(10,10,20,0.7);
  border: 1px solid rgba(200,200,255,0.4);
  box-shadow: 0 0 16px rgba(150,150,255,0.4);
  color: #f0f0ff;
  position: relative;
  overflow: hidden;
}

/* 星屑が吹き出しの中を流れる */
[data-theme="Cosmos"] .machine-bubble::after {
  content: "";
  position: absolute;
  inset: 0;
  background: url('data:image/svg+xml;utf8,\
  <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80">\
  <circle cx="10" cy="10" r="1" fill="white" />\
  <circle cx="40" cy="20" r="1" fill="white" />\
  <circle cx="60" cy="50" r="1" fill="white" />\
  <circle cx="20" cy="70" r="1" fill="white" />\
  </svg>') repeat;
  opacity: 0.25;
  animation: cosmosBubbleStars 8s linear infinite;
}

@keyframes cosmosBubbleStars {
  from { transform: translateY(0); }
  to { transform: translateY(-40px); }
}

/* -----------------------------------------
   Neon（未来・サイバー）
----------------------------------------- */
[data-theme="Neon"] .machine-bubble {
  background: rgba(0,20,30,0.7);
  border: 1px solid #00eaff;
  box-shadow: 0 0 14px rgba(0,234,255,0.4);
  color: #b8ffff;
  position: relative;
  overflow: hidden;
}

/* ネオンの光が縁を走る */
[data-theme="Neon"] .machine-bubble::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 12px;
  border: 2px solid transparent;
  border-top-color: #00eaff;
  border-right-color: #00eaff;
  animation: neonBorder 2s linear infinite;
}

@keyframes neonBorder {
  0% { transform: rotate(0deg); opacity: 0.6; }
  100% { transform: rotate(360deg); opacity: 1; }
}

/* -----------------------------------------
   Ruins（古代文明）
----------------------------------------- */
[data-theme="Ruins"] .machine-bubble {
  background: rgba(180,150,110,0.55);
  border: 1px solid rgba(90,70,50,0.6);
  box-shadow: 0 0 12px rgba(90,70,50,0.3);
  color: #2b1d0f;
  position: relative;
  overflow: hidden;
}

/* 砂が落ちる演出 */
[data-theme="Ruins"] .machine-bubble::after {
  content: "";
  position: absolute;
  inset: 0;
  background: url('data:image/svg+xml;utf8,\
  <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80">\
  <circle cx="10" cy="10" r="1" fill="#5e4b32" />\
  <circle cx="40" cy="20" r="1" fill="#5e4b32" />\
  <circle cx="60" cy="50" r="1" fill="#5e4b32" />\
  <circle cx="20" cy="70" r="1" fill="#5e4b32" />\
  </svg>') repeat;
  opacity: 0.25;
  animation: ruinsSand 6s linear infinite;
}

@keyframes ruinsSand {
  from { transform: translateY(-20px); }
  to { transform: translateY(20px); }
}
/* =========================================================
   Part2-D : Negative Launch Animations (5 Themes)
   MoodOS v3.5
========================================================= */

/* -----------------------------------------
   Crystal（透明・ガラス）
   → ガラス片になって砕けて落ちる
----------------------------------------- */
.launch-crystal {
  animation: crystalLaunch 1.2s ease-out forwards;
}

@keyframes crystalLaunch {
  0% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
    filter: blur(0px);
  }
  40% {
    transform: translate(-50%, -60%) scale(1.05);
    opacity: 0.9;
  }
  60% {
    transform: translate(-50%, -40%) scale(0.9) rotate(3deg);
    opacity: 0.6;
    filter: blur(1px);
  }
  100% {
    transform: translate(-50%, 80%) scale(0.6) rotate(-8deg);
    opacity: 0;
    filter: blur(3px);
  }
}

/* -----------------------------------------
   Midnight（夜・青）
   → 青い霧に溶けて消える
----------------------------------------- */
.launch-midnight {
  animation: midnightLaunch 1.4s ease-out forwards;
}

@keyframes midnightLaunch {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
    filter: blur(0px);
  }
  40% {
    opacity: 0.7;
    transform: translate(-50%, -55%) scale(1.05);
    filter: blur(1px);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -60%) scale(1.1);
    filter: blur(6px);
  }
}

/* -----------------------------------------
   Cosmos（宇宙）
   → 星屑になって上へ吸い込まれる
----------------------------------------- */
.launch-cosmos {
  animation: cosmosLaunch 1.6s ease-out forwards;
}

@keyframes cosmosLaunch {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
    filter: blur(0px);
  }
  30% {
    opacity: 0.9;
    transform: translate(-50%, -60%) scale(1.05);
  }
  60% {
    opacity: 0.6;
    transform: translate(-50%, -90%) scale(0.9);
    filter: blur(2px);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -160%) scale(0.7);
    filter: blur(4px);
  }
}

/* -----------------------------------------
   Neon（未来・サイバー）
   → ピクセル化して分解される
----------------------------------------- */
.launch-neon {
  animation: neonLaunch 1.2s steps(12) forwards;
}

@keyframes neonLaunch {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
    filter: blur(0px);
  }
  40% {
    opacity: 0.8;
    transform: translate(-50%, -50%) scale(1.05);
    filter: blur(1px);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(1.1);
    filter: blur(6px);
    clip-path: inset(0 0 100% 0);
  }
}

/* -----------------------------------------
   Ruins（古代文明）
   → 石板 → ひび割れ → 砂になって風で飛ぶ
----------------------------------------- */
.launch-ruins {
  animation: ruinsLaunch 1.6s ease-out forwards;
}

@keyframes ruinsLaunch {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
    filter: blur(0px);
  }
  40% {
    opacity: 0.9;
    transform: translate(-50%, -55%) scale(1.05);
  }
  70% {
    opacity: 0.6;
    transform: translate(-50%, -40%) scale(0.9) rotate(3deg);
    filter: blur(1px);
  }
  100% {
    opacity: 0;
    transform: translate(-120%, -20%) scale(0.7) rotate(-8deg);
    filter: blur(4px);
  }
}
/* =========================================================
   Part2-E : Theme Card Previews (5 Themes)
   MoodOS v3.5
========================================================= */

/* -----------------------------------------
   Crystal（透明・ガラス）
----------------------------------------- */
.theme-preview-crystal {
  background: linear-gradient(
    135deg,
    rgba(255,255,255,0.8),
    rgba(255,255,255,0.4)
  );
  border: 1px solid rgba(255,255,255,0.7);
  backdrop-filter: blur(6px);
  box-shadow: 0 0 10px rgba(255,255,255,0.5);
}

/* -----------------------------------------
   Midnight（夜・青）
----------------------------------------- */
.theme-preview-midnight {
  background: linear-gradient(145deg, #0d1b2a, #1b263b);
  border: 1px solid #415a77;
  box-shadow: 0 0 10px rgba(65,90,119,0.4);
}

/* -----------------------------------------
   Cosmos（宇宙）
----------------------------------------- */
.theme-preview-cosmos {
  background: radial-gradient(circle at 30% 30%, #ffffff 0%, #8a7cff 20%, #1a1033 70%);
  border: 1px solid #b8aaff;
  box-shadow: 0 0 12px rgba(180,160,255,0.5);
  position: relative;
  overflow: hidden;
}

/* 星屑アニメーション（カード用） */
.theme-preview-cosmos::after {
  content: "";
  position: absolute;
  inset: 0;
  background: url('data:image/svg+xml;utf8,\
  <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80">\
  <circle cx="10" cy="10" r="1" fill="white" />\
  <circle cx="40" cy="20" r="1" fill="white" />\
  <circle cx="60" cy="50" r="1" fill="white" />\
  <circle cx="20" cy="70" r="1" fill="white" />\
  </svg>') repeat;
  opacity: 0.25;
  animation: cosmosCardStars 8s linear infinite;
}

@keyframes cosmosCardStars {
  from { transform: translateY(0); }
  to { transform: translateY(-40px); }
}

/* -----------------------------------------
   Neon（未来・サイバー）
----------------------------------------- */
.theme-preview-neon {
  background: #0a0a0a;
  border: 1px solid #00eaff;
  box-shadow: 0 0 12px rgba(0,234,255,0.4);
  position: relative;
  overflow: hidden;
}

/* ネオンライン */
.theme-preview-neon::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent 0%, #00eaff 50%, transparent 100%);
  opacity: 0.4;
  animation: neonCardScan 2s linear infinite;
}

@keyframes neonCardScan {
  from { transform: translateX(-100%); }
  to { transform: translateX(100%); }
}

/* -----------------------------------------
   Ruins（古代文明）
----------------------------------------- */
.theme-preview-ruins {
  background: linear-gradient(145deg, #c2a878, #8d6e4a);
  border: 1px solid #5e4b32;
  box-shadow: 0 0 10px rgba(120,90,60,0.4);
  position: relative;
  overflow: hidden;
}

/* 砂模様 */
.theme-preview-ruins::after {
  content: "";
  position: absolute;
  inset: 0;
  background: url('data:image/svg+xml;utf8,\
  <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80">\
  <circle cx="10" cy="10" r="1" fill="#5e4b32" />\
  <circle cx="40" cy="20" r="1" fill="#5e4b32" />\
  <circle cx="60" cy="50" r="1" fill="#5e4b32" />\
  <circle cx="20" cy="70" r="1" fill="#5e4b32" />\
  </svg>') repeat;
  opacity: 0.25;
  animation: ruinsCardSand 6s linear infinite;
}

@keyframes ruinsCardSand {
  from { transform: translateY(-20px); }
  to { transform: translateY(20px); }
}

  </style>
</head>
<body>
  <!-- =========================
       App Root
  ========================== -->
  <div id="app-root">

    <!-- =========================
         Header
    ========================== -->
    <header class="app-header">
      <div class="app-title-area">
        <h1 class="app-title">MoodOS</h1>
        <p class="app-subtitle">気分と毎日を、ちいさなOSで。</p>
      </div>

      <div class="app-header-controls">
        <div class="current-date-display">
          <span id="current-year"></span>
          <span> / </span>
          <span id="current-month"></span>
        </div>

        <div class="header-buttons">
          <button id="prev-month-btn" class="header-btn" type="button">◀</button>
          <button id="today-btn" class="header-btn" type="button">今日</button>
          <button id="next-month-btn" class="header-btn" type="button">▶</button>

          <!-- 設定パネルを開くボタン -->
          <button id="open-settings-btn" class="header-btn settings-btn" type="button">
            ⚙ 設定
          </button>
        </div>
      </div>
    </header>

    <!-- =========================
         Main Layout
    ========================== -->
    <main class="app-main">
      <!-- ===== カレンダーエリア ===== -->
      <section class="calendar-section">
        <div class="calendar-header-row">
          <div class="weekday-label">日</div>
          <div class="weekday-label">月</div>
          <div class="weekday-label">火</div>
          <div class="weekday-label">水</div>
          <div class="weekday-label">木</div>
          <div class="weekday-label">金</div>
          <div class="weekday-label">土</div>
        </div>
        <div id="calendar-grid" class="calendar-grid">
          <!-- JS で日付セルを生成 -->
        </div>
      </section>

      <!-- ===== 右側パネル（詳細・タスクなど） ===== -->
      <section class="side-panel-section">
        <!-- 選択中の日付情報 -->
        <div class="selected-day-panel">
          <h2 class="panel-title">選択中の日付</h2>
          <div class="selected-day-display">
            <span id="selected-date-label">未選択</span>
          </div>

          <!-- 機械くんの吹き出し（メッセージ表示用） -->
          <div class="machine-bubble-wrapper">
            <div id="machine-bubble" class="machine-bubble hidden">
              <div class="machine-face">
                <!-- かっこかわいい機械くんの顔は CSS で表現 -->
                <span class="machine-eye left"></span>
                <span class="machine-eye right"></span>
                <span class="machine-mouth"></span>
              </div>
              <div class="machine-message" id="machine-message-text">
                <!-- JS でメッセージを差し込む -->
              </div>
            </div>
          </div>

          <!-- 気分サマリー（その日の記録があれば表示） -->
          <div class="day-summary">
            <h3 class="panel-subtitle">その日の気分</h3>
            <div id="day-mood-summary" class="day-mood-summary">
              記録がありません。
            </div>
          </div>

          <!-- 「今日の気分を記録する」ボタン -->
          <div class="day-actions">
            <button id="open-mood-modal-btn" class="primary-btn" type="button">
              今日の気分を記録する
            </button>
          </div>
        </div>

        <!-- タスクパネル（後でロジック追加） -->
        <div class="task-panel">
          <h2 class="panel-title">今日のタスク</h2>
          <div class="task-input-row">
            <input
              id="new-task-input"
              type="text"
              class="task-input"
              placeholder="タスクを入力して Enter"
            />
            <button id="add-task-btn" class="secondary-btn" type="button">
              追加
            </button>
          </div>
          <ul id="task-list" class="task-list">
            <!-- JS でタスクを追加 -->
          </ul>
        </div>

        <!-- 明日の天気パネル（後でAPIロジック追加） -->
        <div class="weather-panel">
          <h2 class="panel-title">明日の天気</h2>
          <div id="weather-content" class="weather-content">
            <div class="weather-icon-placeholder">☁</div>
            <div class="weather-text">
              <div id="weather-main" class="weather-main">読み込み待ち</div>
              <div id="weather-temp" class="weather-temp"></div>
              <div id="weather-comment" class="weather-comment">
                機械くんがここで一言しゃべるよ。
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- =========================
         Mood Modal（気分記録モーダル）
    ========================== -->
    <div id="mood-modal-backdrop" class="modal-backdrop hidden">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">今日の気分を記録</h2>
          <button id="close-mood-modal-btn" class="modal-close-btn" type="button">×</button>
        </div>

        <div class="modal-body">
          <!-- 気分ボタン群 -->
          <div class="mood-buttons-row">
            <button class="mood-btn" data-mood="great" type="button">最高</button>
            <button class="mood-btn" data-mood="good" type="button">いい感じ</button>
            <button class="mood-btn" data-mood="neutral" type="button">ふつう</button>
            <button class="mood-btn" data-mood="bad" type="button">ちょっとつらい</button>
            <button class="mood-btn" data-mood="awful" type="button">最悪</button>
          </div>

          <!-- メモ欄（嫌なことも含めて書く） -->
          <div class="modal-section">
            <label for="mood-note-input" class="modal-label">メモ</label>
            <textarea
              id="mood-note-input"
              class="modal-textarea"
              rows="4"
              placeholder="今日あったこと、感じたことを書いてみよう"
            ></textarea>
          </div>

          <!-- 嫌なことを飛ばすエリア（演出は後でJS＋CSS） -->
          <div class="modal-section">
            <label for="negative-note-input" class="modal-label">
              嫌だったこと（宇宙に飛ばせるよ）
            </label>
            <textarea
              id="negative-note-input"
              class="modal-textarea negative"
              rows="3"
              placeholder="ここに書いた嫌なことは、あとで宇宙に飛ばせるよ"
            ></textarea>
            <div class="negative-actions">
              <button id="launch-negative-btn" class="danger-btn" type="button">
                嫌なことを宇宙に飛ばす
              </button>
              <span class="negative-note-hint">
                ※ 飛ばした内容は保存されません
              </span>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="save-mood-btn" class="primary-btn" type="button">
            記録を保存
          </button>
        </div>
      </div>

      <!-- 嫌なことが宇宙に飛んでいく演出用レイヤー -->
      <div id="negative-launch-layer" class="negative-launch-layer hidden">
        <div class="negative-card" id="negative-card-visual">
          <!-- JS でテキストを差し込んで、CSSアニメーションで飛ばす -->
        </div>
        <div class="space-background">
          <!-- 星屑や宇宙っぽい演出は CSS で -->
        </div>
      </div>
    </div>

    <!-- =========================
         Settings Panel（設定パネル）
    ========================== -->
    <div id="settings-backdrop" class="settings-backdrop hidden">
      <div class="settings-panel">
        <div class="settings-header">
          <h2 class="settings-title">設定</h2>
          <button id="close-settings-btn" class="settings-close-btn" type="button">×</button>
        </div>

        <div class="settings-body">
          <!-- ===== テーマ設定 ===== -->
          <section class="settings-section">
            <h3 class="settings-section-title">テーマ</h3>
            <p class="settings-section-desc">
              好きな世界観を選んでね。見た目はいつでも変更できます。
            </p>

            <div class="theme-card-grid">
              <!-- Crystal -->
              <button
                class="theme-card"
                data-theme="Crystal"
                type="button"
              >
                <div class="theme-card-preview theme-preview-crystal"></div>
                <div class="theme-card-info">
                  <div class="theme-card-name">Crystal</div>
                  <div class="theme-card-desc">白くて透明な、ガラスの世界。</div>
                </div>
              </button>

              <!-- Midnight -->
              <button
                class="theme-card"
                data-theme="Midnight"
                type="button"
              >
                <div class="theme-card-preview theme-preview-midnight"></div>
                <div class="theme-card-info">
                  <div class="theme-card-name">Midnight</div>
                  <div class="theme-card-desc">静かな夜の、青い世界。</div>
                </div>
              </button>

              <!-- Cosmos -->
              <button
                class="theme-card"
                data-theme="Cosmos"
                type="button"
              >
                <div class="theme-card-preview theme-preview-cosmos"></div>
                <div class="theme-card-info">
                  <div class="theme-card-name">Cosmos</div>
                  <div class="theme-card-desc">星屑が漂う、宇宙の世界。</div>
                </div>
              </button>

              <!-- Neon -->
              <button
                class="theme-card"
                data-theme="Neon"
                type="button"
              >
                <div class="theme-card-preview theme-preview-neon"></div>
                <div class="theme-card-info">
                  <div class="theme-card-name">Neon</div>
                  <div class="theme-card-desc">光のラインが走る、未来の世界。</div>
                </div>
              </button>

              <!-- Ruins -->
              <button
                class="theme-card"
                data-theme="Ruins"
                type="button"
              >
                <div class="theme-card-preview theme-preview-ruins"></div>
                <div class="theme-card-info">
                  <div class="theme-card-name">Ruins</div>
                  <div class="theme-card-desc">古代文明の遺跡のような世界。</div>
                </div>
              </button>
            </div>
          </section>

          <!-- ===== 音・音声設定（UIだけ先に用意） ===== -->
          <section class="settings-section">
            <h3 class="settings-section-title">サウンド</h3>
            <p class="settings-section-desc">
              ボタンを押したときなどの音を選べます。（後で実装予定）
            </p>

            <div class="sound-options">
              <label class="sound-option">
                <input type="radio" name="sound-pack" value="pop" checked />
                <span class="sound-option-label">ポップ（ピッ・ポン）</span>
              </label>
              <label class="sound-option">
                <input type="radio" name="sound-pack" value="clear" />
                <span class="sound-option-label">クリア（キーン・コロン）</span>
              </label>
              <label class="sound-option">
                <input type="radio" name="sound-pack" value="mecha" />
                <span class="sound-option-label">メカ（カチッ・キュッ）</span>
              </label>
              <label class="sound-option">
                <input type="radio" name="sound-pack" value="voice" />
                <span class="sound-option-label">機械くんボイス（予定）</span>
              </label>
            </div>
          </section>

          <!-- ===== アカウント・同期（UIだけ先に用意） ===== -->
          <section class="settings-section">
            <h3 class="settings-section-title">アカウントと同期</h3>
            <p class="settings-section-desc">
              ユーザー名とパスワードで、データを同期できるようにする予定です。
            </p>

            <div class="account-form">
              <div class="account-row">
                <label for="account-username" class="account-label">ユーザー名</label>
                <input
                  id="account-username"
                  type="text"
                  class="account-input"
                  placeholder="例：kenta_mood"
                />
              </div>
              <div class="account-row">
                <label for="account-password" class="account-label">パスワード</label>
                <input
                  id="account-password"
                  type="password"
                  class="account-input"
                  placeholder="●●●●●●●●"
                />
              </div>
              <div class="account-actions">
                <button id="account-login-btn" class="secondary-btn" type="button">
                  ログイン
                </button>
                <button id="account-register-btn" class="secondary-btn" type="button">
                  新規登録
                </button>
              </div>
              <p class="account-note">
                ※ ここはまだダミーです。後で本物の同期機能をつなぎます。
              </p>
            </div>
          </section>
        </div>
      </div>
    </div>

    <!-- =========================
         Audio Elements（サウンド用）
    ========================== -->
    <audio id="ui-sound-tap" src="" preload="auto"></audio>
    <audio id="ui-sound-save" src="" preload="auto"></audio>
    <audio id="ui-sound-close" src="" preload="auto"></audio>
    <audio id="ui-sound-launch" src="" preload="auto"></audio>

  </div>

  <!-- =========================
       Scripts（JS は Part3で）
  ========================== -->
  <script>
    ///* =========================================================
   Part3-A : Base Logic + Calendar Generation
   MoodOS v3.5
========================================================= */

/* ------------------------------
   Global State
------------------------------ */
let currentDate = new Date();
let selectedDate = null;

/* ------------------------------
   DOM Elements
------------------------------ */
const calendarGrid = document.getElementById("calendar-grid");
const currentYearLabel = document.getElementById("current-year");
const currentMonthLabel = document.getElementById("current-month");
const selectedDateLabel = document.getElementById("selected-date-label");

/* ------------------------------
   Render Calendar
------------------------------ */
function renderCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();

  currentYearLabel.textContent = year;
  currentMonthLabel.textContent = month + 1;

  // 月初と月末
  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month + 1, 0).getDate();

  calendarGrid.innerHTML = "";

  // 空白セル
  for (let i = 0; i < firstDay; i++) {
    const empty = document.createElement("div");
    empty.className = "calendar-cell empty";
    calendarGrid.appendChild(empty);
  }

  // 日付セル
  for (let day = 1; day <= lastDate; day++) {
    const cell = document.createElement("div");
    cell.className = "calendar-cell";
    cell.textContent = day;

    const dateKey = `${year}-${month + 1}-${day}`;

    // 選択状態
    if (selectedDate === dateKey) {
      cell.classList.add("selected");
    }

    // クリック
    cell.addEventListener("click", () => {
      selectedDate = dateKey;
      selectedDateLabel.textContent = `${year}年 ${month + 1}月 ${day}日`;
      renderCalendar();
      loadDaySummary();
      showMachineMessage("dateSelect");
    });

    calendarGrid.appendChild(cell);
  }
}

/* ------------------------------
   Month Navigation
------------------------------ */
document.getElementById("prev-month-btn").addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  renderCalendar();
});

document.getElementById("next-month-btn").addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  renderCalendar();
});

document.getElementById("today-btn").addEventListener("click", () => {
  currentDate = new Date();
  renderCalendar();
});

/* ------------------------------
   Day Summary Loader
------------------------------ */
function loadDaySummary() {
  const summaryBox = document.getElementById("day-mood-summary");

  if (!selectedDate) {
    summaryBox.textContent = "記録がありません。";
    return;
  }

  const saved = localStorage.getItem("mood-" + selectedDate);
  if (!saved) {
    summaryBox.textContent = "記録がありません。";
    return;
  }

  const data = JSON.parse(saved);
  summaryBox.textContent = `気分：${data.mood}\nメモ：${data.note || "なし"}`;
}

/* ------------------------------
   Init
------------------------------ */
renderCalendar();
/* =========================================================
   Part3-B : Mood Modal + Save + Negative Launch
   MoodOS v3.5
========================================================= */

/* ------------------------------
   Modal Elements
------------------------------ */
const moodModalBackdrop = document.getElementById("mood-modal-backdrop");
const openMoodModalBtn = document.getElementById("open-mood-modal-btn");
const closeMoodModalBtn = document.getElementById("close-mood-modal-btn");
const saveMoodBtn = document.getElementById("save-mood-btn");

const moodButtons = document.querySelectorAll(".mood-btn");
let selectedMood = null;

/* ------------------------------
   Open / Close Modal
------------------------------ */
openMoodModalBtn.addEventListener("click", () => {
  if (!selectedDate) {
    alert("日付を選択してね！");
    return;
  }
  moodModalBackdrop.classList.remove("hidden");
});

closeMoodModalBtn.addEventListener("click", () => {
  moodModalBackdrop.classList.add("hidden");
});

/* ------------------------------
   Select Mood
------------------------------ */
moodButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    selectedMood = btn.dataset.mood;
    moodButtons.forEach(b => b.classList.remove("selected"));
    btn.classList.add("selected");
  });
});

/* ------------------------------
   Save Mood
------------------------------ */
saveMoodBtn.addEventListener("click", () => {
  if (!selectedMood) {
    alert("気分を選んでね！");
    return;
  }

  const note = document.getElementById("mood-note-input").value;

  const data = {
    mood: selectedMood,
    note: note
  };

  localStorage.setItem("mood-" + selectedDate, JSON.stringify(data));

  moodModalBackdrop.classList.add("hidden");
  renderCalendar();
  loadDaySummary();
  showMachineMessage("saved");
});

/* =========================================================
   嫌なことを宇宙（テーマに応じた世界）へ飛ばす
========================================================= */

const launchBtn = document.getElementById("launch-negative-btn");
const negativeInput = document.getElementById("negative-note-input");
const launchLayer = document.getElementById("negative-launch-layer");
const launchCard = document.getElementById("negative-card-visual");

launchBtn.addEventListener("click", () => {
  const text = negativeInput.value.trim();
  if (!text) {
    alert("嫌だったことを書いてね！");
    return;
  }

  // カードにテキストを入れる
  launchCard.textContent = text;

  // 現在のテーマを取得
  const theme = document.documentElement.dataset.theme.toLowerCase();

  // 既存アニメーションをリセット
  launchCard.className = "negative-card";

  // テーマ別アニメーションを付与
  launchCard.classList.add(`launch-${theme}`);

  // レイヤーを表示
  launchLayer.classList.remove("hidden");
  launchLayer.classList.add("active");

  // 機械くんのセリフ
  showMachineMessage("launch", theme);

  // アニメーション終了後に非表示
  setTimeout(() => {
    launchLayer.classList.remove("active");
    setTimeout(() => {
      launchLayer.classList.add("hidden");
    }, 300);
  }, 1600);

  // 入力欄をクリア
  negativeInput.value = "";
});
/* =========================================================
   Part3-C : Machine-kun Speech (Theme-based)
   MoodOS v3.5
========================================================= */

const machineBubble = document.getElementById("machine-bubble");
const machineMessageText = document.getElementById("machine-message-text");

/* ------------------------------
   テーマ別セリフセット
------------------------------ */
const machineMessages = {
  Crystal: {
    dateSelect: [
      "今日の気分、聞かせてね。",
      "透明な気持ちでいこう。",
      "ここから一日が始まるよ。"
    ],
    saved: [
      "ガラスみたいに澄んだ記録だね。",
      "保存したよ。すごくいい感じ。",
      "今日の気持ち、ちゃんと届いたよ。"
    ],
    launch: [
      "割っておいたよ。もう大丈夫。",
      "透明な世界に溶かしておいたよ。",
      "ガラス片になって消えていったよ。"
    ]
  },

  Midnight: {
    dateSelect: [
      "静かな夜みたいに落ち着いてるね。",
      "今日の気分、そっと教えて。",
      "深呼吸して、ゆっくりいこう。"
    ],
    saved: [
      "夜空に記録しておいたよ。",
      "静かに保存したよ。",
      "今日の気持ち、ちゃんと受け取った。"
    ],
    launch: [
      "夜に溶かしておいたよ。",
      "青い霧になって消えていったよ。",
      "静かに遠くへ流れていったよ。"
    ]
  },

  Cosmos: {
    dateSelect: [
      "星の位置、ばっちりだよ。",
      "今日の気分、宇宙に刻もう。",
      "星屑みたいにきらめく一日になるといいね。"
    ],
    saved: [
      "宇宙に記録しておいたよ。",
      "星のデータに保存完了。",
      "今日の気持ち、星屑に混ぜておいたよ。"
    ],
    launch: [
      "宇宙に預けておいたよ。",
      "星屑になって飛んでいったよ。",
      "ブラックホールに吸い込んでおいたよ。"
    ]
  },

  Neon: {
    dateSelect: [
      "未来ログ、準備完了。",
      "今日の気分、データ化しよう。",
      "光のラインが走ってるよ。"
    ],
    saved: [
      "データ保存完了。",
      "未来システムに記録したよ。",
      "ログ更新、正常に完了。"
    ],
    launch: [
      "データ消去完了。スッキリしたね。",
      "ピクセル化して削除したよ。",
      "ノイズとして処理しておいたよ。"
    ]
  },

  Ruins: {
    dateSelect: [
      "古代の石板に刻む準備ができたよ。",
      "今日の気分、教えてくれ。",
      "砂の時間が流れていくね。"
    ],
    saved: [
      "石板に刻んでおいたよ。",
      "記録を遺跡に保管したよ。",
      "今日の気持ち、しっかり残したよ。"
    ],
    launch: [
      "砂に返しておいたよ。",
      "風に乗って消えていったよ。",
      "古代の風が運んでいったよ。"
    ]
  }
};

/* ------------------------------
   セリフ表示関数
------------------------------ */
function showMachineMessage(type, themeOverride = null) {
  const theme = themeOverride
    ? themeOverride.charAt(0).toUpperCase() + themeOverride.slice(1)
    : document.documentElement.dataset.theme;

  const messages = machineMessages[theme][type];
  const text = messages[Math.floor(Math.random() * messages.length)];

  machineMessageText.textContent = text;
  machineBubble.classList.remove("hidden");

  // 少し時間が経ったら消える
  setTimeout(() => {
    machineBubble.classList.add("hidden");
  }, 3500);
}
/* =========================================================
   Part3-D : Theme Switching + Settings Panel
   MoodOS v3.5
========================================================= */

/* ------------------------------
   Settings Panel Open/Close
------------------------------ */
const settingsBackdrop = document.getElementById("settings-backdrop");
const openSettingsBtn = document.getElementById("open-settings-btn");
const closeSettingsBtn = document.getElementById("close-settings-btn");

openSettingsBtn.addEventListener("click", () => {
  settingsBackdrop.classList.remove("hidden");
});

closeSettingsBtn.addEventListener("click", () => {
  settingsBackdrop.classList.add("hidden");
});

/* ------------------------------
   Theme Switching
------------------------------ */
const themeCards = document.querySelectorAll(".theme-card");

themeCards.forEach(card => {
  card.addEventListener("click", () => {
    const theme = card.dataset.theme;

    // HTML にテーマをセット
    document.documentElement.dataset.theme = theme;

    // 保存
    localStorage.setItem("moodos-theme", theme);

    // 機械くんのセリフ
    showMachineMessage("dateSelect");

    // 設定パネルを閉じる
    settingsBackdrop.classList.add("hidden");
  });
});

/* ------------------------------
   Load Saved Theme
------------------------------ */
(function loadSavedTheme() {
  const saved = localStorage.getItem("moodos-theme");
  if (saved) {
    document.documentElement.dataset.theme = saved;
  }
})();
/* =========================================================
   Part3-E : Task System (Add / Remove / Save)
   MoodOS v3.5
========================================================= */

const taskInput = document.getElementById("new-task-input");
const addTaskBtn = document.getElementById("add-task-btn");
const taskList = document.getElementById("task-list");

/* ------------------------------
   Load Tasks for Selected Date
------------------------------ */
function loadTasks() {
  if (!selectedDate) {
    taskList.innerHTML = "";
    return;
  }

  const saved = localStorage.getItem("tasks-" + selectedDate);
  if (!saved) {
    taskList.innerHTML = "";
    return;
  }

  const tasks = JSON.parse(saved);
  taskList.innerHTML = "";

  tasks.forEach((task, index) => {
    const li = createTaskElement(task, index);
    taskList.appendChild(li);
  });
}

/* ------------------------------
   Create Task Element
------------------------------ */
function createTaskElement(text, index) {
  const li = document.createElement("li");
  li.className = "task-item";

  const span = document.createElement("span");
  span.textContent = text;

  const delBtn = document.createElement("button");
  delBtn.textContent = "削除";
  delBtn.className = "secondary-btn";

  delBtn.addEventListener("click", () => {
    deleteTask(index);
  });

  li.appendChild(span);
  li.appendChild(delBtn);

  return li;
}

/* ------------------------------
   Add Task
------------------------------ */
addTaskBtn.addEventListener("click", addTask);
taskInput.addEventListener("keydown", e => {
  if (e.key === "Enter") addTask();
});

function addTask() {
  if (!selectedDate) {
    alert("日付を選択してね！");
    return;
  }

  const text = taskInput.value.trim();
  if (!text) return;

  const saved = localStorage.getItem("tasks-" + selectedDate);
  const tasks = saved ? JSON.parse(saved) : [];

  tasks.push(text);
  localStorage.setItem("tasks-" + selectedDate, JSON.stringify(tasks));

  taskInput.value = "";
  loadTasks();
  showMachineMessage("saved");
}

/* ------------------------------
   Delete Task
------------------------------ */
function deleteTask(index) {
  const saved = localStorage.getItem("tasks-" + selectedDate);
  if (!saved) return;

  const tasks = JSON.parse(saved);
  tasks.splice(index, 1);

  localStorage.setItem("tasks-" + selectedDate, JSON.stringify(tasks));
  loadTasks();
}

/* ------------------------------
   Load Tasks When Date Changes
------------------------------ */
(function initTaskSystem() {
  loadTasks();
})();
/* =========================================================
   Part3-F : Weather Panel (Dummy API + Theme Comments)
   MoodOS v3.5
========================================================= */

const weatherMain = document.getElementById("weather-main");
const weatherTemp = document.getElementById("weather-temp");
const weatherComment = document.getElementById("weather-comment");

/* ------------------------------
   ダミー天気データ
------------------------------ */
const dummyWeatherTypes = [
  { main: "晴れ", icon: "☀", temp: 18 },
  { main: "くもり", icon: "☁", temp: 15 },
  { main: "雨", icon: "🌧", temp: 12 },
  { main: "雪", icon: "❄", temp: 2 },
  { main: "風", icon: "🌬", temp: 10 }
];

/* ------------------------------
   テーマ別コメント
------------------------------ */
const weatherComments = {
  Crystal: {
    晴れ: "光がきれいに反射しそうだね。",
    くもり: "ガラス越しの空も悪くないよ。",
    雨: "しずくが透明で、少しきれいだよ。",
    雪: "白い世界が広がりそうだね。",
    風: "風がガラスを鳴らすかも。"
  },
  Midnight: {
    晴れ: "夜空が澄んで見えそうだよ。",
    くもり: "静かな空気が流れてるね。",
    雨: "雨音が心を落ち着かせてくれるよ。",
    雪: "夜の雪は特別に静かだよ。",
    風: "風が夜を運んでくるね。"
  },
  Cosmos: {
    晴れ: "星がよく見えるかも。",
    くもり: "雲の向こうにも宇宙はあるよ。",
    雨: "星屑みたいな雨だね。",
    雪: "宇宙の粒みたいに舞ってるよ。",
    風: "銀河の風が吹いてるみたいだね。"
  },
  Neon: {
    晴れ: "光がよく走りそうだよ。",
    くもり: "曇りでもシステムは安定だよ。",
    雨: "雨粒がネオンに反射してきれいだよ。",
    雪: "白いノイズみたいで面白いね。",
    風: "風速データ、上昇中。"
  },
  Ruins: {
    晴れ: "太陽が遺跡を照らすよ。",
    くもり: "砂の匂いがしそうだね。",
    雨: "石がしっとり濡れる日だよ。",
    雪: "古代の地にも雪は降るんだね。",
    風: "砂が舞うかもしれないよ。"
  }
};

/* ------------------------------
   天気をランダム生成
------------------------------ */
function loadWeather() {
  const data = dummyWeatherTypes[Math.floor(Math.random() * dummyWeatherTypes.length)];

  weatherMain.textContent = `${data.icon} ${data.main}`;
  weatherTemp.textContent = `${data.temp}℃`;

  const theme = document.documentElement.dataset.theme;
  const comment = weatherComments[theme][data.main];

  weatherComment.textContent = comment;
}

/* ------------------------------
   初期化
------------------------------ */
loadWeather();
/* =========================================================
   Part3-G : Final Touches (Sound / Init / Safety)
   MoodOS v3.5
========================================================= */

/* ------------------------------
   UI Sounds（後で音源を入れる前提）
------------------------------ */
const soundTap = document.getElementById("ui-sound-tap");
const soundSave = document.getElementById("ui-sound-save");
const soundClose = document.getElementById("ui-sound-close");
const soundLaunch = document.getElementById("ui-sound-launch");

function playSound(audio) {
  if (!audio) return;
  audio.currentTime = 0;
  audio.play().catch(() => {});
}

/* ボタン音（軽めに） */
document.querySelectorAll("button").forEach(btn => {
  btn.addEventListener("click", () => playSound(soundTap));
});

/* 保存音 */
saveMoodBtn.addEventListener("click", () => playSound(soundSave));

/* モーダル閉じる音 */
closeMoodModalBtn.addEventListener("click", () => playSound(soundClose));

/* 嫌なこと飛ばす音 */
launchBtn.addEventListener("click", () => playSound(soundLaunch));

/* ------------------------------
   日付変更時にタスクも更新
------------------------------ */
function updateAllForSelectedDate() {
  loadDaySummary();
  loadTasks();
}

document.querySelectorAll(".calendar-cell").forEach(cell => {
  cell.addEventListener("click", updateAllForSelectedDate);
});

/* ------------------------------
   初期化（テーマ・天気・タスク）
------------------------------ */
(function initMoodOS() {
  // テーマ
  const savedTheme = localStorage.getItem("moodos-theme");
  if (savedTheme) {
    document.documentElement.dataset.theme = savedTheme;
  }

  // 天気
  loadWeather();

  // タスク
  loadTasks();

  // 機械くんの初回メッセージ
  setTimeout(() => {
    showMachineMessage("dateSelect");
  }, 800);
})();

  </script>
</body>
</html>
